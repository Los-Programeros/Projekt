name: Tests

on:
  workflow_run:
    workflows: ["Auto Server Deployment"]
    types:
      - completed

jobs:
  test-containers:
    name: Test Containers
    runs-on: self-hosted
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    
    steps:
      - name: Get project from Github
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install libraries
        run: |
          cd .tests
          pip install -r requirements.txt
      
      - name: Run MongoDB connection test
        run: python3 test_mongo.py
      
      - name: Notify on failure
        if: failure()
        run: echo "Tests failed!"